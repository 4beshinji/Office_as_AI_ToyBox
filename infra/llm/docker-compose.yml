version: '3.8'

services:
  # --- Local LLM Engine (Radeon/ROCm) ---
  # To enable: ensure /dev/kfd and /dev/dri exist on the host machine
  llm-engine:
    image: rocm/vllm:latest
    container_name: soms-llm-engine
    restart: unless-stopped
    devices:
      - /dev/kfd:/dev/kfd
      - /dev/dri:/dev/dri
    ports:
      - "8000:8000"
    volumes:
      - soms_models:/root/.cache/huggingface
    environment:
      - HUGGING_FACE_HUB_TOKEN=${HF_TOKEN}
    # Command optimized for 32B model on consumer GPUs. Adjust --tensor-parallel-size if using multiple GPUs.
    command: --model Qwen/Qwen2.5-32B-Instruct-AWQ --quantization awq --gpu-memory-utilization 0.95 --tensor-parallel-size 1
    networks:
      - soms-llm-net

volumes:
  soms_models:


networks:
  soms-llm-net:
    driver: bridge
